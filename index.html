<!DOCTYPE html>  <html> <head>   <title>jquery.iframe-transport.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               jquery.iframe-transport.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This <a href="http://jquery.com/">jQuery</a> plugin implements an <code>&lt;iframe&gt;</code>
<a href="http://api.jquery.com/extending-ajax/#Transports">transport</a> so that
<code>$.ajax()</code> calls support the uploading of files using standard HTML file
input fields. This is done by switching the exchange from <code>XMLHttpRequest</code> to
a hidden <code>iframe</code> element containing a form that is submitted.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The <a href="http://github.com/cmlenz/jquery-iframe-transport">source for the plugin</a>
is available on <a href="http://github.com/">Github</a> and dual licensed under the MIT
or GPL Version 2 licenses.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Usage</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>To use this plugin, you simply add a <code>iframe</code> option with the value <code>true</code>
to the Ajax settings an <code>$.ajax()</code> call, and specify the file fields to
include in the submssion using the <code>files</code> option, which can be a selector,
jQuery object, or a list of DOM elements containing one or more
<code>&lt;input type="file"&gt;</code> elements:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <pre><code>$("#myform").submit(function() {
    $.ajax(this.action, {
        files: $(":file", this),
        iframe: true
    }).complete(function(data) {
        console.log(data);
    });
});
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The plugin will construct a hidden <code>&lt;iframe&gt;</code> element containing a copy of
the form the file field belongs to, will disable any form fields not
explicitly included, submit that form, and process the response.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>If you want to include other form fields in the form submission, include them
in the <code>data</code> option, and set the <code>processData</code> option to <code>false</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <pre><code>$("#myform").submit(function() {
    $.ajax(this.action, {
        data: $(":text", this).serializeArray(),
        files: $(":file", this),
        iframe: true,
        processData: false
    }).complete(function(data) {
        console.log(data);
    });
});
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>The Server Side</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>If the response is not HTML or XML, you (unfortunately) need to apply some
trickery on the server side. To send back a JSON payload, send back an HTML
<code>&lt;textarea&gt;</code> element with a <code>data-type</code> attribute that contains the MIME
type, and put the actual payload in the textarea:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <pre><code>&lt;textarea data-type="application/json"&gt;
  {"ok": true, "message": "Thanks so much"}
&lt;/textarea&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>The iframe transport plugin will detect this and attempt to apply the same
conversions that jQuery applies to regular responses. That means for the
example above you should get a Javascript object as the <code>data</code> parameter of
the <code>complete</code> callback, with the properties <code>ok: true</code> and
<code>message: "Thanks so much"</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>Compatibility</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>This plugin has primarily been tested on Safari 5, Firefox 4, and Internet
Explorer all the way back to version 6. While I haven't found any issues with
it so far, I'm fairly sure it still doesn't work around all the quirks in all
different browsers. But the code is still pretty simple overall, so you
should be able to fix it and contribute a patch :)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Annotated Source</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Register a prefilter that checks whether the <code>iframe</code> option is set, and
switches to the iframe transport if it is <code>true</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxPrefilter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">origOptions</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">iframe</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;iframe&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Register an iframe transport, independent of requested data type. It will
only activate when the "files" option has been set to a non-empty list of
enabled file inputs.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxTransport</span><span class="p">(</span><span class="s2">&quot;iframe&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">origOptions</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">iframe</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">origAction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">origTarget</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">origEnctype</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">addedFields</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">disabledFields</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">files</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">files</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:file:enabled&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>This function gets called after a successful submission or an abortion
and should revert all changes made to the page to enable the
submission via this transport.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">cleanUp</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">addedFields</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">disabledFields</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="nx">origAction</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="nx">origTarget</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;enctype&quot;</span><span class="p">,</span> <span class="nx">origEnctype</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">iframe</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;javascript:false;&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Remove "iframe" from the data types list so that further processing is
based on the content type returned by the server, without attempting an
(unsupported) conversion from "iframe" to the actual type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">options</span><span class="p">.</span><span class="nx">dataTypes</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Determine the form the file fields belong to, and make sure they all
actually belong to the same form.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">files</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">form</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">form</span> <span class="o">!==</span> <span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;All file fields must belong to the same form&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">form</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">form</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Store the original form attributes that we'll be replacing temporarily.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">origAction</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">);</span>
      <span class="nx">origTarget</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">);</span>
      <span class="nx">origEnctype</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;enctype&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>We need to disable all other inputs in the form so that they don't get
included in the submitted data unexpectedly.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;:input:not(:submit)&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span> <span class="o">||</span> <span class="nx">files</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">disabledFields</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>If there is any additional data specified via the <code>data</code> option,
we add it as hidden fields to the form. This (currently) requires
the <code>processData</code> option to be set to false so that the data doesn't
get serialized to a string.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;data must not be serialized&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="p">{},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">name</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">addedFields</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input type=&#39;hidden&#39;&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">form</span><span class="p">));</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Add a hidden <code>X-Requested-With</code> field with the value <code>IFrame</code> to the
field, to help server-side code to determine that the upload happened
through this transport.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">addedFields</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input type=&#39;hidden&#39; name=&#39;X-Requested-With&#39;&gt;&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;IFrame&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">form</span><span class="p">));</span>

      <span class="k">return</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>The <code>send</code> function is called by jQuery when the request should be
sent.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">send</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">headers</span><span class="p">,</span> <span class="nx">completeCallback</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">iframe</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;iframe src=&#39;javascript:false;&#39; name=&#39;iframe-&quot;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
            <span class="o">+</span> <span class="s2">&quot;&#39; style=&#39;display:none&#39;&gt;&lt;/iframe&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>The first load event gets fired after the iframe has been injected
into the DOM, and is used to prepare the actual submission.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">iframe</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>The second load event gets fired when the response to the form
submission is received. The implementation detects whether the
actual payload is embedded in a <code>&lt;textarea&gt;</code> element, and
prepares the required conversions to be made in that case.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">iframe</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">contentWindow</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span> <span class="o">:</span>
                <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nb">document</span><span class="p">),</span>
                <span class="nx">root</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">?</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
                <span class="nx">textarea</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;textarea&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="nx">type</span> <span class="o">=</span> <span class="nx">textarea</span> <span class="o">?</span> <span class="nx">textarea</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;data-type&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
              <span class="nx">completeCallback</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">text</span><span class="o">:</span> <span class="nx">type</span> <span class="o">?</span> <span class="nx">textarea</span><span class="p">.</span><span class="nx">value</span> <span class="o">:</span> <span class="nx">root</span> <span class="o">?</span> <span class="nx">root</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">:</span> <span class="kc">null</span>
              <span class="p">},</span> <span class="s2">&quot;Content-Type: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">type</span> <span class="o">||</span> <span class="s2">&quot;text/html&quot;</span><span class="p">));</span>
              <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">cleanUp</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Now that the load handler has been set up, reconfigure and
submit the form.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;enctype&quot;</span><span class="p">,</span> <span class="s2">&quot;multipart/form-data&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
          <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>After everything has been set up correctly, the iframe gets
injected into the DOM so that the submission can be initiated.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">iframe</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>The <code>abort</code> function is called by jQuery when the request should be
aborted.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">abort</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">iframe</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">iframe</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;javascript:false;&quot;</span><span class="p">);</span>
            <span class="nx">cleanUp</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>

      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 